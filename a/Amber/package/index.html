
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the UAntwerpen-modules repository">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.5">
    
    
      
        <title>Package - UAntwerpen-modules documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.2d9f7617.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="black" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#amber" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="UAntwerpen-modules documentation" class="md-header__button md-logo" aria-label="UAntwerpen-modules documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            UAntwerpen-modules documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Package
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="" data-md-color-primary="black" data-md-color-accent=""  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      Pacakge list
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../index.html#a" class="md-tabs__link">
      A
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="UAntwerpen-modules documentation" class="md-nav__button md-logo" aria-label="UAntwerpen-modules documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    UAntwerpen-modules documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Pacakge list
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#a" class="md-nav__link">
        A
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#available-easyconfigs" class="md-nav__link">
    Available EasyConfigs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#technical-documentation" class="md-nav__link">
    Technical documentation
  </a>
  
    <nav class="md-nav" aria-label="Technical documentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general-information" class="md-nav__link">
    General information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#amber-installation-process" class="md-nav__link">
    Amber installation process
  </a>
  
    <nav class="md-nav" aria-label="Amber installation process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#choice-of-build-processes" class="md-nav__link">
    Choice of build processes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cpu-build-types" class="md-nav__link">
    CPU build types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-the-amber-and-ambertools-patches" class="md-nav__link">
    Adding the Amber and AmberTools patches
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#amber-and-ambertools-dependencies" class="md-nav__link">
    Amber and AmberTools dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-problems-i-ran-into-with-amber-18-and-ambertools-19" class="md-nav__link">
    Other problems I ran into with Amber 18 and AmberTools 19
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-amber-with-easybuild" class="md-nav__link">
    Building Amber with EasyBuild
  </a>
  
    <nav class="md-nav" aria-label="Building Amber with EasyBuild">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#amber-18-ambertools-19-in-the-2019b-and-2020a-toolchains" class="md-nav__link">
    Amber 18 / AmberTools 19 in the 2019b and 2020a toolchains
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#amber-20-ambertools-20-in-the-2020a-toolchains" class="md-nav__link">
    Amber 20 / AmberTools 20 in the 2020a toolchains
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in-case-of-problems" class="md-nav__link">
    In case of problems..
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<p><a href="../../..">[package list]</a></p>
<h1 id="amber">Amber</h1>
<h2 id="available-easyconfigs">Available EasyConfigs</h2>
<ul>
<li><a href="../Amber-18-intel-2019b-AmberTools-19-patchlevel-17-9/">Amber-18-intel-2019b-AmberTools-19-patchlevel-17-9.eb</a></li>
<li><a href="../Amber-18-intel-2020a-AmberTools-19-patchlevel-17-12/">Amber-18-intel-2020a-AmberTools-19-patchlevel-17-12.eb</a></li>
<li><a href="../Amber-20-intel-2019b-AmberTools-20-patchlevel-6-11-CUDA/">Amber-20-intel-2019b-AmberTools-20-patchlevel-6-11-CUDA.eb</a></li>
<li><a href="../Amber-20-intel-2020a-AmberTools-20-patchlevel-6-10/">Amber-20-intel-2020a-AmberTools-20-patchlevel-6-10.eb</a></li>
</ul>
<h2 id="technical-documentation">Technical documentation</h2>
<ul>
<li><a href="https://ambermd.org/index.php">Amber web site</a></li>
</ul>
<h3 id="general-information">General information</h3>
<p>Amber consists of two parts that should be installed together. There is the actual 
Amber package itself, and AmberTools, with a number of additional tools that
can also be used without Amber. AmberTools seems to be updated more frequently than 
Amber.</p>
<p>The software has an EasyBlock that is capable of installing both. Yet even then the 
software needs a significant amount of patching to make the installation process compatible 
with the EasyBuild conventions. There are some bad decisions in the configure scripts 
of Amber, including explicitly looking for X11 libraries in specific directories.</p>
<p>Since Amber is semi-commercial software, an account is needed to download the software. 
Hence Amber and a matching version of AmberTools should be downloaded beforehand to 
the sources directory as downloading them from EasyBuild will fail, even with the correct 
URL. The patches for Amber and AmberTools can be downloaded freely though.</p>
<h3 id="amber-installation-process">Amber installation process</h3>
<p>The Amber documentation process is very badly documented. Hence this text with a number 
of problems we ran into trying to install Amber on the UAntwerp systems. Basically 
one needs to investigate installation code and the output of the configuration and 
build processes to figure out all the options and dependencies of the code.</p>
<h4 id="choice-of-build-processes">Choice of build processes</h4>
<p>In Amber 18, there are two build processes that are kind of supported. However, both 
appear to be very buggy.
  * A <code>configure</code>-based one that is considered to be the stable build process. Though 
    very similar to traditional autotools-generated configure scripts, it looks like 
    at least part if not all of the configure scripts that are being used are actually 
    hand-written or modified from generated ones. There are definitely hidden parameters 
    that are not shown with <code>--help</code> or <code>--full-help</code>.
  * A CMake-based process that in version 18 is still considered experimental. It is 
    not guaranteed to work in all environments or for all types of builds, and I indeed 
    could not get it to work.</p>
<p>Note that some people have reported that using a parallel make process may fail...</p>
<h4 id="cpu-build-types">CPU build types</h4>
<p>Not counting the CUDA GPU builds, different types of builds are supported. However,
it seems that only the executables that are explicitly supported for that build type 
are being build and rather than do a fallback to a 'lower' level for the other 
executables.
   * Serial build. This seems to build the largest set of executables.
   * MPI build: Using either <code>-mpi</code> or <code>-itelmpi</code> with <code>configure</code>
   * OpenMP build: Using <code>-openmp</code> with <code>configure</code>
   * Hybrid MPI/OpenMP build: Using <code>-openmp</code> in combination with either <code>-mpi</code> or <code>-intelmpi</code>.</p>
<h4 id="adding-the-amber-and-ambertools-patches">Adding the Amber and AmberTools patches</h4>
<p>A new version of Amber is released roughly every two years, a new version of AmberTools
roughly every year. They come as two <code>.tar.bz2</code> files. AmberTools can be installed
without Amber, but Amber cannot be installed without AmberTools.
However, during their life span, both receive numerous patches while the tar 
archives are not updated.
These can be found on:
   * <a href="https://ambermd.org/ATPatches.php">AmberTools patches page</a>
   * <a href="https://ambermd.org/AmberPatches.php">Amber patches page</a></p>
<p>Amber does come with a tool that will automatically download and apply the patches.
<code>update_amber</code>. With this tool, it is possible to specify up to which patchlevel both
Amber and AmberTools should be upgraded to get reproducible installations.</p>
<p>Moreover, it is possible to download the patches by hand, put them in a specific directory, 
and let update_amber then apply the patches without re-downloading them again. 
That may save some time, but using this mechanism we can also save the patches together 
with the sources files for later re-installations so that Amber can be reinstalled 
in a reproducible way also should the patches no longer be available.
Patches are stored in:
   * <code>.patches/Amber&lt;version&gt;_Unapplied_Patches</code> for Amber (replace <code>&lt;version&gt;</code> with 
     the version number of Amber)
   * <code>.patches/AmberTools&lt;version&gt;_Unapplied_Patches</code> for AmberTools (replace <code>&lt;version&gt;</code> with 
     the version number of AmberTools)</p>
<p>Running <code>update_amber</code> with the specification of the right patch level will not re-download
the patches but only apply them. E.g.,
<div class="highlight"><pre><span></span><code>./update_amber --update-to AmberTools/9,Amber/17
</code></pre></div></p>
<h4 id="amber-and-ambertools-dependencies">Amber and AmberTools dependencies</h4>
<p>Discovering the true dependencies requires a lot of engineering as there is no complete 
list in the manual. It really requires looking into all output of configure and/or 
cmake and sometimes even figuring it out from the output of the build process and from
the source code.</p>
<ul>
<li>libz</li>
<li>bzip2, though the CMake build process fails to recognize the library even though 
    it is provided through a module.</li>
<li>It is best to use an optimised BLAS and Lapack implementation. MKL is supported.</li>
<li>Arpack, but the code comes with an internal version (in AmberTools)</li>
<li>FFTW, but the code comes with an internal version and fails to recognize an external 
    FFTW3 library. The configure script in Amber 18 doesn't even try to find one.</li>
<li>netCDF, preferably with PnetCDF as the parallel backend for the old netCDF data
    formats. The PnetCDF support is used by <code>cpptraj</code>. The code contains an internal 
    version; however, it is not clear if and when it tries to compile the internal PnetCDF. 
    (TODO: Check further, maybe only included automatically in MPI builds which is actually 
    very reasonable?)</li>
<li>Boost, though the code comes with an internal version</li>
<li>Perl 5, as it does install a number of Perl scripts (optional?)</li>
<li>Python, as some of the tools come as Python scripts. It is not clear which other
    packages are needed... The manual mentions that either Python 2.7 or Python 3.4 or
    later should be used.
    It is also not fully clear which other Python packages are needed, though 
    the manual does mention:<ul>
<li>NumPy  </li>
<li>SciPy</li>
<li>matplotlib</li>
<li>cython</li>
<li>IPython and notebook? Not useful for job scripts, these are tools for interactive 
    work.</li>
</ul>
</li>
</ul>
<h4 id="other-problems-i-ran-into-with-amber-18-and-ambertools-19">Other problems I ran into with Amber 18 and AmberTools 19</h4>
<p>The cmake build process clearly does not yet work properly when trying to do a MPI/OpenMP 
build. Moreover, it fails to find libraries that are clearly present, e.g., libbz2.</p>
<p>The configure script is considered to be mature even though there are features that 
are marked as experimental, in particular <code>--prefix</code>. Note that without <code>--prefix</code>, one 
needs to do an in-place build and then clean up (likely by hand) files that are not 
needed for running Amber. In fact, all EasyConfigs I found (see further down) for versions 
of Amber available in December 2019 used in-place builds. In some configurations we 
got crashes during the build process that may be due to bugs in the Makefiles in combination 
with a configure with <code>--prefix</code>.</p>
<p>Usual practice with cmake or configure generated makefiles using libtool is that <code>VERBOSE=1</code> 
or <code>V=1</code> show the full command being executed. This does not work with the Amber makefiles. 
To discover what is really happening, set the variable SHELL in calls of make to <code>sh 
-x</code>, hence add <code>SHELL='sh-s'</code> to the make command line.</p>
<p>When selecting Intel as the compiler, the configure process does seem to know how to 
set suitable compiler options without using environment variables such as CXX_FLAGS. 
Some files are compiled with -O0 but this may be deliberate since they are known to 
sometimes fail when optimization is turned on. However, though most modules are compiled 
with very reasonable options, in some modules only -O or -O3 is used without -xHost. 
This implies that these modules are only optimized for whatever Intel considers the 
default processor for the version of the compiler, and this in turn implies that AVX 
or younger vector instructions typically are not used. Which means that the performance 
potential of every recent processor (where recent really is less than 6 years old) 
remains unexploited.</p>
<p>Likely suboptimal compile options were found in:
  * UCPP: AmberTools/src/ucpp-1.3: No optimization options given
  * CIFPARSE: AmberTools/src/cifparse: No optimization options given
  * ANTECHAMBER: AmberTools/src/antechamber: No optimization options given
  * REDUCE, 
      * AmberTools/src/reduce/toolclasses: Uses only <code>-O</code>, without <code>-xHost</code>.
      * AmberTools/src/reduce/libpdb: idem
      * AmberTools/src/reduce/reduce_src: Uses <code>-O3</code> but no <code>-xHost</code>
  * LEAP: AmberTools/src/leap/src/leap: No optimization options given
  * EMIL: AmberTools/src/emil: Uses <code>-O3</code> but no <code>-xHost</code>
  * NMRAUX:
      * AmberTools/src/nmr_aux/prepare_input: No optimization options
  * CPPTRAJ: AmberTools/src/cpptraj/src and subdirectories: Uses <code>-O3</code> but no <code>-xHost</code>
  * AMBPDB: AmberTools/src/ambpdb: Uses <code>-O3</code> but no <code>-xHost</code>
  * NAB: AmberTools/src/nab: No optimization options
  * ETC: AmberTools/src/etc: No optimization options
  * RISM: AmberTools/src/rism: The build process returns repeatedly to this directory, 
    and somtimes files get compiled with very reasonable optimization options while 
    sometimes these options appear to be completely missing.
  * SAXS: AmberTools/src/saxs: Uses <code>-O3</code> but no <code>-xHost</code>
  * CPHSTATS: AmberTools/src/cphstats: No optimization options
  * NFE: AmberTools/src/nfe-umbrella-slice: No optimization options </p>
<p>Programs that are compiled during the configure phase in a not so optimal way:
  * Boost is compiled with the GNU C++ compiler instead of the Intel one. <code>-O3</code> is used 
    but without <code>-march=native</code>. Though that probably does not matter to much for most 
    of what is in Boost.</p>
<h3 id="building-amber-with-easybuild">Building Amber with EasyBuild</h3>
<p>The first version covered by this documentation is the installation of Amber 18 with
AmberTools 19 in the 2019b toolchains.</p>
<ul>
<li>There is a EasyBlock for Amber that makes sure that updates are applied, etc. It 
    does seem to require a remarkable number of patches mostly to the configure scripts 
    of Amber to work properly.</li>
<li>Places where other EasyConfigs for Amber can be found:<ul>
<li><a href="https://github.com/easybuilders/easybuild-easyconfigs/tree/develop/easybuild/easyconfigs/a/Amber">EasyBuilder EasyConfig repository on github</a>,
    with the <a href="https://github.com/easybuilders/easybuild-easyblocks/blob/develop/easybuild/easyblocks/a/amber.py">matching EasyBlock</a>.
    These EasyConfigs require a lot of patching of the Amber and AmberTools sources. 
    One problem with this is that even just a patch to Amber or AmberTools may invalidate 
    one or more of the EasyBuild-provided patches, making upgrading to a newer version 
    a real pain in the ass.</li>
<li><a href="https://github.com/ComputeCanada/easybuild-easyconfigs/tree/computecanada-master/easybuild/easyconfigs/a/Amber">ComputeCanada github repository</a>.
    ComputeCanada starts from the default EasyBuilder EasyConfigs.</li>
<li><a href="https://code.it4i.cz/sccs/easyconfigs-it4i/tree/master/a/Amber">IT4I github repository</a>. 
    IT4I does use the EasyBlock for Amber, but doesn't seem to need the pletora of 
    patches used in the EasyBuilder EasyConfigs.</li>
<li><a href="https://github.com/eth-cscs/production/tree/master/easybuild/easyconfigs/a/Amber">CSCS github repository</a>. 
    In their typical way, they avoid using the application-specific EasyBlock and 
    instead push all steps in a traditional MakeCp-based EasyConfig. In their newer 
    versions they build several build types together in one module, which may be 
    a good thing as otherwise some modules would be missing some commands (e.g., 
    the ones that don't support MPI, OpenMP or hybrid mode).</li>
</ul>
</li>
</ul>
<h4 id="amber-18-ambertools-19-in-the-2019b-and-2020a-toolchains">Amber 18 / AmberTools 19 in the 2019b and 2020a toolchains</h4>
<p>For the development of the EasyConfig used at UAntwerp, we started from the CSCS one
but extended it in several ways.</p>
<ul>
<li>As <code>--prefix</code> still works unreliably in Amber18, we do an in-place build and 
    remove the sources afterwards.</li>
<li>As with the regular EasyConfig for Amber, one should set the number of patches 
    for AmberTools and Amber at the start of the 
    EasyConfig file, see the variable patchlevel. To determine the correct number, go to<ul>
<li><a href="https://ambermd.org/ATPatches.php">AmberTools patches page</a></li>
<li><a href="https://ambermd.org/AmberPatches.php">Amber patches page</a></li>
</ul>
</li>
<li>We specify the extract command for the tar files so that the amberXX/-prefix is already
    removed at the untar phase. Furthermore we extend the source list with all patches for
    Amber and AmberTools, and make sure they are downloaded to the appropriate subdirectories
    AmberXX and AmberToolsYY of the Sources subdirectory to avoid name conflicts. We use
    <code>extract_cmd</code> to move these to the correct subdirectories of the unpacked sources.</li>
<li>As we cannot adapt the installation of the patches without writing or adapting the 
    EasyBlock for Amber, we install the patches with <code>update_amber</code> during the configure phase.</li>
<li>Just as in the CSCS EasyConfig, we do 4 builds of Amber in the same directories, 
    in the order serial, OpenMP, hybrid MPI+OpenMP and MPI. Note that the serial build is 
    needed to ensure that the full set of tools is installed, as the other options only seem
    to install those tools that support either OpenMP or MPI. However, by first doing the 
    serial build, we also ensure that OpenMP versions of the tools will overwrite the serial
    ones if they exist.</li>
<li>We use <code>postinstallcmds</code> to clean up the sources.</li>
</ul>
<p>Some tricks in the EasyConfig to work around problems in Amber:
  * No host-specific optimizations in CPPTRAJ: The configure script of CPPTRAJ is called without 
    the <code>-tune</code> from <code>AmberTools/src/configure2.*</code> option and therefore does only enable 
    optimizations but no host-specific optimizations. There is a workaround by specifying the 
    compiler option for the host-specific optimizations via the environment variable <code>TUNEFLAGS</code>.</p>
<p>NOTE: Amber doesn't always build properly on BeeGFS. It sometimes fails with message 
such as "resource busy". It looks like some locks are not released quickly enough or 
so.</p>
<h4 id="amber-20-ambertools-20-in-the-2020a-toolchains">Amber 20 / AmberTools 20 in the 2020a toolchains</h4>
<ul>
<li>A straightforward port.</li>
<li>We no longer use TUNEFLAGS as the option gets overwritten anyway as these flags are already
    added via the CFLAGS etc. passed by EasyBuild (and causes warnings on Rome that they get
    overwritten).</li>
</ul>
<h3 id="in-case-of-problems">In case of problems..</h3>
<ul>
<li>It may be necessary to reset CFLAGS etc when calling configure in the EasyConfig and instead make
    proper use of TUNEFLAGS (see the 2019b toolchain) to set the optimization options (and be careful
    with AMD Rome). Some files are now compiled with <code>-O0</code> which gets overwritten by a <code>-O2</code> included
    in CFLAGS etc.</li>
</ul>
<p><a href="../../..">[package list]</a></p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    <a href="https://github.com/hpcuantwerpen" target="_blank" rel="noopener" title="HPC-UAntwerpen on GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "header.autohide", "toc.follow", "content.code.annotate", "search.suggest"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.bd0b6b67.min.js"}</script>
    
    
      <script src="../../../assets/javascripts/bundle.467223ff.min.js"></script>
      
    
  </body>
</html>