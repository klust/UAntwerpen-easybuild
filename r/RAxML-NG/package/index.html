
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the UAntwerpen-modules repository">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.5">
    
    
      
        <title>Package - UAntwerpen-modules documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.2d9f7617.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="black" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#raxml-ng" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="UAntwerpen-modules documentation" class="md-header__button md-logo" aria-label="UAntwerpen-modules documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            UAntwerpen-modules documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Package
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="" data-md-color-primary="black" data-md-color-accent=""  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      Pacakge list
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../index.html#a" class="md-tabs__link">
      A
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="UAntwerpen-modules documentation" class="md-nav__button md-logo" aria-label="UAntwerpen-modules documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    UAntwerpen-modules documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Pacakge list
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html#a" class="md-nav__link">
        A
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#available-easyconfigs" class="md-nav__link">
    Available EasyConfigs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#technical-documentation" class="md-nav__link">
    Technical documentation
  </a>
  
    <nav class="md-nav" aria-label="Technical documentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general-information" class="md-nav__link">
    General information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cmake-configuration-as-it-is-in-the-code" class="md-nav__link">
    CMake configuration as it is in the code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#easyconfigs" class="md-nav__link">
    EasyConfigs
  </a>
  
    <nav class="md-nav" aria-label="EasyConfigs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#version-041" class="md-nav__link">
    Version 0.4.1
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#version-081" class="md-nav__link">
    Version 0.8.1
  </a>
  
    <nav class="md-nav" aria-label="Version 0.8.1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#version-090" class="md-nav__link">
    Version 0.9.0
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<p><a href="../../..">[package list]</a></p>
<h1 id="raxml-ng">RAxML-NG</h1>
<h2 id="available-easyconfigs">Available EasyConfigs</h2>
<ul>
<li><a href="../RAxML-NG-0.9.0-GCCcore-8.3.0-pthreads-hopper/">RAxML-NG-0.9.0-GCCcore-8.3.0-pthreads-hopper.eb</a></li>
<li><a href="../RAxML-NG-0.9.0-GCCcore-8.3.0-pthreads/">RAxML-NG-0.9.0-GCCcore-8.3.0-pthreads.eb</a></li>
<li><a href="../RAxML-NG-0.9.0-intel-2019b/">RAxML-NG-0.9.0-intel-2019b.eb</a></li>
<li><a href="../RAxML-NG-0.9.0-intel-2020a/">RAxML-NG-0.9.0-intel-2020a.eb</a></li>
</ul>
<h2 id="technical-documentation">Technical documentation</h2>
<ul>
<li><a href="https://github.com/amkozlov/raxml-ng">GitHub</a></li>
<li>The authors mentioned seem to have one thing in common: They are or have been at
  HITS, the <a href="https://www.h-its.org/">Heidelberg Institute for Theoretical Studies</a>,
  so that is the likely source of the code.</li>
</ul>
<h3 id="general-information">General information</h3>
<ul>
<li>RAxML has a number of dependencies that have no official releases. They are not
  included in the source code if you download a tar file from the GitHub repository.
  Therefore it is better to get the sources via a recursive git clone.</li>
<li>Dependencies: RAxML-NG uses the following libraries (<code>libs</code> subdirectory)<ul>
<li><a href="https://github.com/amkozlov/terraphast-one">terraphast</a> which is a clone of
  the <a href="https://github.com/upsj/terraphast-one">original terraphast Github is on the upsj account</a>
  developed by Tobias Ribizel from KIT, Karlsruhe.</li>
<li><a href="https://github.com/ddarriba/pll-modules">pll-modules</a> which has a different 
  author (Diego Darriba, now at Coru√±a but before at HITS). It looks like this
  subproject is pretty dead at the moment.<ul>
<li>pll-modules uses <a href="https://github.com/xflouris/libpll-2">libpll</a> which has yet another
  author, Tomas Flouri who seems to be linked to both UCL, london and HITS. 
  The libpll code seems to be as dead as pll-modules, both saw their last 
  update in June 2017.
  Stored in the <code>libs/libpll</code> subdirectory of <code>libs/pll-modules</code>.</li>
</ul>
</li>
</ul>
</li>
<li>RAxML-NG supports distributed memory parallelisation with MPI and shared memory 
  parallelisation using pthreads. It is not clear if using both together really gives
  a hybrid executable as the documentation is mostly missing. In any case, MPI is only
  used by the RAxML-NG code itself, not by any of the dependencies (terraphast or 
  pll-modules/libpll).</li>
<li>libpll has different code for SSE, AVX and AVX2, and a generic code path as an 
  alternative. <ul>
<li>The SSE, AVX and AVX2 codes use intrinsics so this may give problems
  with some compilers that don't support certain intrinsics.</li>
<li>Even if a system supports AVX2, it is best to leave the lower options
  activated also as a lower code path is sometimes used if there is no
  benefit of using a higher one.</li>
<li>All three code paths should always be activated if supported, unless 
  <code>-DENABLE_SSE=false</code>, <code>-DENABLE_AVX=false</code>
  and/or <code>-DENABLE_AVX2=false</code> are specified. Check what CMake does 
  to be sure if the right code paths are compiled into the code. </li>
</ul>
</li>
<li>The main RAxML-NG code is C++. Hence the CXX-range of options matter. </li>
<li>pll-modules and libpll is C-code.</li>
<li>terraphast is C++-code. Moreover, it uses some intrinsics that may be
  compiler-specific in the code in the <code>lib</code> subdirectory. There are some
  header files to solve portability problems, with support for GCC, Clang
  and the Microsoft compiler.<ul>
<li>It does turn out that all the directives that are used in the GCC/Clang
  version are also supported by the Intel compiler since the 2018 releases.</li>
<li>This is also the component of the code that can use the GNU GMP library.</li>
</ul>
</li>
</ul>
<h3 id="cmake-configuration-as-it-is-in-the-code">CMake configuration as it is in the code</h3>
<table>
<tr><th>Variable</th>                <th>Default</th> <th>Meaning</th></tr>
<tr><td>RAXML_BINARY_NAME</td>       <td></td>        <td>Custom RAxML-NG binary name</td></tr>
<tr><td>USE_LIBPLL_CMAKE</td>        <td>ON</td>      <td>Use CMake to build libpll and pll-modules. Will be forced to ON when building as a library</td></tr>
<tr><td>BUILD_AS_LIBRARY</td>        <td>OFF</td>     <td>Build RAxML-NG as shared library (instead of stand-alone executable). Naming is derived from the name of the matching executable.</td></tr>
<tr><td>USE_PTHREADS</td>            <td>ON</td>      <td>Enable multi-threading support (PTHREADS)</td></tr>
<tr><td>USE_MPI</td>                 <td>OFF</td>     <td>Enable MPI support</td></tr>
<tr><td>USE_VCF</td>                 <td>OFF</td>     <td>??? No explanation available</td></tr>
<tr><td>ENABLE_PLLMOD_SIMD</td>      <td>OFF</td>     <td>Enable SIMD instructions in pll-modules (non-portable but slightly faster)</td></tr>
<tr><td>STATIC_BUILD</td>            <td>OFF</td>     <td>Build static binary (don't use with MPI!)</td></tr>
<tr><td>USE_TERRAPHAST</td>          <td>ON</td>      <td>Use phylogentic terraces library (terraphast)</td></tr>
<tr><td>USE_GMP</td>                 <td>OFF</td>     <td>Use Gnu Muliple precision (GMP) library, only relevant for terraphast</td></tr>
<tr><td></td>    <td></td>    <td></td></tr>
<tr><td>MPI_CXX_COMPILER</td>        <td></td>        <td>Used if USED_MPI is ON</td></tr>
<tr><td>MPI_CXX_COMPILER_FLAGS</td>  <td></td>        <td>Used if USE_MPI is ON</td></tr>
<tr><td>ENABLE_SSE</td>              <td>True</td>    <td>Used to enable or explicitly disable SSE3 optimizations in libpll</td></tr>
<tr><td>ENABLE_AVX</td>              <td>True</td>    <td>Used to enable or explicitly disable AVX optimizations in libpll</td></tr>
<tr><td>ENABLE_AVX2</td>             <td>True</td>    <td>Used to enable or explicitly disable AVX2 optimizations in libpll</td></tr>
<tr><td></td>    <td></td>    <td></td></tr>
<tr><td></td>    <td></td>    <td></td></tr>
<tr><td></td>    <td></td>    <td></td></tr>
</table>

<ul>
<li>When no custom binary name is given (which is advised), the name of the binary
  depends on a number of options.</li>
<li>No MPI, no static linking: <code>raxml-ng</code></li>
<li>No MPI, static linking: <code>raxml-ng-static</code></li>
<li>MPI, no static linking: <code>raxml-ng-mpi</code></li>
<li>MPI with static linking is not supported??</li>
<li>There are more options, e.g., <code>PLLMOD_DEBUG</code>, that are only relevant to 
  code development and not to creating a user installation.</li>
<li>It is really the implementation of <code>ENABLE_RAXML_SIMD</code> and <code>ENABLE_PLLMOD_SIMD</code>
  that is problematic (at least in version 0.9.0, when this was written) as it
  currently enforces the selection between very bad and bad compiler options for
  performance on modern hardware.</li>
<li>The CMAKE_C_... and CMAKE_CXX_... are used in the recipe but not taken from the
  environment or defines on the command line as they have the type <code>INTERNAL</code>.</li>
<li>From version 0.9.0 on, <code>make install</code> is supported to install the binaries, but
  it does not work correctly when installing RAxML-NG as a shared library as it is put in
  bin instead of in lib or lib64.</li>
</ul>
<h3 id="easyconfigs">EasyConfigs</h3>
<p>EasyConfigs were developed at UAntwerp as there was no support for the -NG version
in EasyBuild when we started. By now there is <a href="https://github.com/easybuilders/easybuild-easyconfigs/blob/develop/easybuild/easyconfigs/r/RAxML-NG/RAxML-NG-0.9.0-gompi-2019b.eb">an official EasuBuilders
recipe for RAxML-NG</a>
that however suffers from most of the problems that we indicate below.</p>
<p>This documentation was started when installing version 0.9.0. However, we did try to
reconstruct what we did in earlier versions and cover this in the documentation also.</p>
<p>The main problem with installing RAxML-NG is the poor quality of the build scripts.
They impose certain compiler options that 
  1. are only valid for GCC and
  2. are for ancient systems (Ivy Bridge and before) and suboptimal for later systems.</p>
<p>As the root CMake file then further calls configure scripts  </p>
<h4 id="version-041">Version 0.4.1</h4>
<ul>
<li>This was still without terraphast.</li>
<li>We needed to adapt the main CMakeList.txt file to recognize the Intel compilers.
  This was not sufficient though, libpll was still compiled in a suboptimal way
  (no <code>-xHost</code>).</li>
<li>The recipe does not do a download of the sources from GitHub, this still has to
  be done manually.</li>
</ul>
<h3 id="version-081">Version 0.8.1</h3>
<ul>
<li>This version now comes with with terraphast which we didn't get to compile with 
  the Intel compiler. Since we didn't have a full FOSS toolchain with working MPI 
  set up at the time, we did not build a distributed memory version.</li>
<li>We made similar changes to the main CMakeLists.txt file. We now had to stick to
  the GCC compilers though. Which also were used in a suboptimal way for the 
  dependencies. We tried to add the Intel compiler to the recognized compilers,
  and additional options for the SIMD settings chosing better compiler options.</li>
</ul>
<h4 id="version-090">Version 0.9.0</h4>
<ul>
<li>Rather than using the system of the EasyBuilders recipe of downloading
  4 files, 3 of them based on commits that have to be looked up first, we
  use EasyBuild's feature to use a recursive download of a tag on the GitHub
  and assemble the download file that way. This saves us from looking up
  that commits that are needed for the dependencies every time we install
  a new version.</li>
<li>Added GMP which turned out to be useless in the original code as the
  support in a subproject was turned off, see below.</li>
<li>The CMake configuration now supports "make install" so we now use that to
  install the software.</li>
<li>Using the default CMakeLists.txt file: Compiled with GCCcore for Hopper 
  (Ivybridge architecture) as this is the only machine for which the compiler
  flags are somewhat reasonable. This still implies that the terraphast component
  is compiled without any optimizations, just the default generic architecture
  -O0 of GCC due to bugs in the configuration procedure.</li>
<li>We made a lot of fixes to the whole CMake configuration process (see the
  subsections below). We ended up with the following configuration:</li>
<li>Ensure that the compiler options are picked up from EasyBuild and that
     the defaults from CMake are fully surpressed by setting <code>ENFORCE_COMPILER_FLAGS</code>
     to OFF and initializing all CMAKE_C<em><em>FLAGS</em></em> (some are already done 
     automatically by EasyBuild).</li>
<li>Turn on SIMD optimizations for pll-modules (in fact, for libpll), but 
     setting the specific optimization options in SSE_FLAGS, AVX_FLAGS
     and AVX2_FLAGS off as they should already be covered by the 
     options to optimize for a specific architecture chosen by EasyBuild
     (and if they are not, that level of SIMD is not supported anyway
     by the architecture).</li>
<li>We turn on terraphast and compile it with GMP support.</li>
<li>Threading support is also turned on, also in the MPI version.</li>
<li>There is something we cannot explain yet: libpll did compile on Hopper
     (Ivybridge) using only -xHost and no AVX2-specific option. CMake did not
     detect that there was no AVX2 and the code also compiled without problems.
     So it looks like what is called AVX2 might not be AVX2? OR what happened to
     the intrinsics, becasue they do look like AVX2 intrinsics...</li>
</ul>
<h5 id="remarks-on-the-configuration-and-compilation-process">Remarks on the configuration and compilation process</h5>
<ul>
<li><code>pll-modules</code> and <code>libpll</code> pick up compiler options that are passed through 
  the environment, but add additional ones that may not be optimal for the chosen 
  compiler or not be valid.</li>
<li><code>terraphast</code> looked like a complete disaster, but this was more due to
  RAxML-NG making a mess of compiler settings and configuration. 
  The main code is compiled OK now and with a few corrections to the CMakeLists.txt 
  file and a bug fix which was not yet included in the version that ships with 
  RAxML-NG, it now compiles OK with Intel also.</li>
</ul>
<h6 id="main-raxml-ng-package">Main RAxML-NG package</h6>
<ul>
<li>Problems with the main code configuration:<ul>
<li>One problematic block is the block that starts with <code>if (ENABLE_RAXML_SIMD )</code>
  in the <code>CMakeLists.txt</code> file in the root directory of RAxML-NG as it imposes
  compiler options and does so at the end, overwriting options that a knowledgeble
  user may consider more appropriate. Moreover, a compiler may have different
  options to activate AVX or SSE3 support. The variables that are defined 
  (<code>__SSE3</code> and <code>__AVX</code>) aren't used in the code.</li>
<li><code>CMAKE_CXX_FLAGS_DEBUG</code> and several similar variables were set to type <code>INTERNAL</code>
  rather than <code>STRING</code>, probihibiting the user to overwrite them, which is a very
  bad idea. After all, the user may need different flags for his/her compiler.</li>
<li>Adding <code>-D_RAXML_PTHREADS -pthread</code> to <code>CMAKE_C_FLAGS</code> while compiling 
  the dependencies, does not make sense at all as that information is not used in
  those codes anyway.</li>
<li>The block that is executed when <code>ENABLE_GMP</code> is <code>ON</code> comes too early.
  Moreover, it assumes that the terraphast initialization will indeed succeed in
  locating the GMP libraries which is also not the case, especially since 
  <code>TERRAPHAST_USE_GMP</code> seems to be turned off in <code>raxml-ng/libs/CMakeLists.txt</code>.</li>
</ul>
</li>
<li><strong>Modifications to <code>CMakeLists.txt</code> in <code>raxml-ng</code>, the main RAxML-ng directory:</strong><ul>
<li>Also recognize the Intel compiler.</li>
<li>Made compiler arguments that are added dependent on the compiler as not all 
  options are accepted by all compilers.</li>
<li>Made it possible for a user to overwrite all default compiler flags so that 
  it is possible to more or less adapt to other compilers, or chose better options
  for a particular architecture.</li>
<li>Removed the block that starts with <code>if (ENABLE_GMP)</code> as it does
  nothing useful: GMP is only used through terraphast, and when done correctly,
  no information about GMP is needed in the main project.</li>
<li>Removed the problematic block that starts with <code>if (ENABLE_RAXML_SIMD )</code> and\
  the option <code>ENABLE_RAXML_SIMD</code> as it only hurts.</li>
<li>Provide a lot more feedback to the user. It may not be important to a very 
  inexperienced user, but it does help an experienced user to check if everything
  works as intended.</li>
</ul>
</li>
<li><strong>Modifications to <code>CMakeLists.txt</code> in <code>raxml-ng/src</code>:</strong><ul>
<li>The terrace library from the terraphast subproject was included in the wrong
  way and therefore the GMP libraries were also not found when linking.</li>
<li>Non-essential modifications that provide additional output to diagnose
  what CMake is doing. It is not strictly needed to patch this file.</li>
</ul>
</li>
<li><strong>Modifications to <code>CMakeLists.txt</code> in <code>raxml-ng/test/src</code>:</strong><ul>
<li>Got rid of the GMP block as that is not needed if the terraces project
  is included in the right way (which is the case now with the patches
  to <code>CMakeLists.txt</code> in <code>`raxml-ng</code>).</li>
</ul>
</li>
<li><strong>Modifications to <code>CMakeLists.txt</code> in <code>raxml-ng/libs</code>:</strong><ul>
<li>USE_GMP or its processed value in ENABLE_GMP was not passed on
  to the terraphast code. This has been corrected. It was probably due
  to the author not being able to figure out how to link properly to
  the GMP library.</li>
<li>USE_THREADS or its processed value ENABLE_THREADS is not passed on 
  to the terraphast code. This has been corrected. It is not clear if
  this is due to problems with threading between the main RAxML-NG and 
  the terraphast code or not.</li>
</ul>
</li>
</ul>
<h6 id="pll-modules-and-libpll">pll-modules and libpll</h6>
<ul>
<li>pll-modules uses the compiler options passed to it in CMAKE_C_FLAGS augmented 
  with options hard-coded in PLLMOD_CFLAGS defined in its src subdirectory.<ul>
<li>It does add an optimization option to this variable also, which is a
   bad idea as they belong are better set in <code>CMAKE_C_FLAGS_RELEASE</code> or 
   <code>CMAKE_C_FLAGS</code> (and is set as the options are passed earlier in the 
   hierarchy).</li>
</ul>
</li>
<li>libpll uses the compiler options passed to in it in CMAKE_C_FLAGS augmented 
  with options hard-coded in LIBPLL_BASE_FLAGS defined in its src subdirectory.<ul>
<li>And it is not clear what it does with the <code>SIMD_FLAGS</code> that it builds
   beyond testing for SSE3, AVX and AVX2 support.</li>
<li>The individual SIMD flags for each type are used though when compiling 
   a file of that type. Hence it might be better to allow to replace them
   by empty options to not conflict with other target-specific options that
   may be specified.</li>
</ul>
</li>
<li><strong>Modifications to <code>CMakeLists.txt</code> in <code>libpll/src</code>:</strong><ul>
<li>Removed the optimization level from <code>LIBPLL_BASE_FLAGS</code> as this should
   be set in <code>CMAKE_C_FLAGS_RELEASE</code> or <code>CMAKE_C_FLAGS</code> (and is set 
   as the options are passed earlier in the hierarchy). <em>Note that if libpll
   is to be used as an independent component, some of the code to detect
   the C compiler and set appropriate defaults for these variables should
   probably be copied from <code>raxml-ng/CMakeLists.txt</code> to 
   <code>libpll/CMakeLists.txt</code>.</em></li>
<li>Allow the user to specify SSE_FLAGS, AVX_FLAGS and AVX2_FLAGS, with the
   old GNU values as the default. If the user specifies architectural compile
   options through CMAKE_C_FLAGS that support certain SIMD extensions, these
   options are not needed, not to detect if support is present and not to 
   compile the code.</li>
</ul>
</li>
<li><strong>Modifications to <code>CMakeLists.txt</code> in <code>pll-modules</code>:</strong><ul>
<li>Only non-essential modifications producing additional output to make it
   easier to follow what CMake is doing have been added to the file.</li>
</ul>
</li>
<li><strong>Modifications to <code>CMakeLists.txt</code> in <code>pll-modules/src</code>:</strong><ul>
<li>Removed the optimization option <code>-O3</code> from <code>PLLMOD_CFLAGS</code> as it is
   better to get those from <code>CMAKE_C_FLAGS_RELEASE</code> or <code>CMAKE_C_FLAGS</code>.
   <em>Note that if pll-modules
   is to be used as an independent component, some of the code to detect
   the C compiler and set appropriate defaults for these variables should
   probably be copied from <code>raxml-ng/CMakeLists.txt</code> to 
   <code>pll-modules/CMakeLists.txt</code>.</em></li>
</ul>
</li>
</ul>
<h6 id="terraphast">terraphast</h6>
<ul>
<li>Analysis of portability problems in the code<ul>
<li><code>lib</code> subdirectory: The files <code>gcc-clang/intrinsics.hpp</code> and
  <code>cl/intrinsics.hpp</code> map a number of functions to intrinsics for respectively
  GCC and Clang and the Microsoft C/C++ compiler. The GNU/Clang version uses:<ul>
<li><code>__builtin_popcountll</code>: This intrinsic is supported in the Intel 16 (2016)
  and later compilers. We didn't check older Intel compilers. </li>
<li><code>__builtin_ctzll</code> and <code>__builtin_clzll</code>: Supported in the Intel compilers
  version 16 (2016) and later. I didn't try older compilers.</li>
<li><code>__builtin_add_overflow</code>, <code>__builtin_mul_overflow</code> are supported since
  version 18 (2018 suite).</li>
</ul>
</li>
</ul>
</li>
<li>The whole configuration process is organised from a single <code>CMakeLists.txt</code> file
  in the root <code>terraphast</code> directory.</li>
<li>There is a double problem with the option <code>TERRAPHAST_ARCH_NATIVE</code>:<ul>
<li>The option it adds is not valid for all compilers. E.g., for the Intel compiler
  it should be <code>-xHost</code> (which then is bad for AMD)</li>
<li>It does not make sense to add <code>-march=native</code> automatically if you don't add
  other optimization options, as the default for the GNU C++ compiler is <code>-O0</code>.</li>
</ul>
</li>
<li>The support for the GNU GMP library is broken. For some reason, the Makefile sees
  gmpxx and gmp as targets rather than libraries it should add when linking,
  resulting in a message from make it cannot build those targets.<ul>
<li>Building libterraces.a works (-DTERRAPHAST_BUILD_CLIB=OFF -DTERRAPHAST_BUILD_APPS=OFF
  -DTERRAPHAST_BUILD_TESTS=OFF) and this is all that is needed to build RAxML-NG.</li>
<li>Building the C library also works (-DTERRAPHAST_BUILD_CLIB=ON which is the default).</li>
<li>Building the apps fails (-DTERRAPHAST_BUILD_APPS=ON which is the default)</li>
<li>Building the unit tests fails (-DTERRAPHAST_BUILD_TESTS=ON which is the default).</li>
<li>The root cause of the problems is a badly designed <code>FindGMP.cmake</code> block that
  lacked a crucial line, and was also not optimal in helping the user to find the 
  correct library files.</li>
</ul>
</li>
<li><strong>Modifications to <code>terraphast/cmake/FindGMP.cmake</code></strong><ul>
<li>Defined a new CMake variable, <code>GMP_PREFIX</code> that points to the directory 
  where the include and lib or lib64 subdirectories can be found, and added
  corresponding <code>PATHS</code> clauses to the <code>find_path</code> and <code>find_library</code> calls. 
  This may not be optimal in Windows, but on our system for some reason CMake 
  failed to find the include files and libraries using the standard search
  directories that we have defined in our environment (<code>CFILES</code> and <code>LIBRARY_PATH</code>).
  It also ensures that now at the end of the function, <code>GMP_LIBRARIES</code> and
  <code>GMPXX_LIBRARIES</code> contain the full library name including the path, which 
  was needed for a correct dependency search when building the apps and test
  executables.</li>
<li>Added a crucial <code>set_target_properties</code> line for <code>gmpxx</code> that was missing.
  Without that line, linking failed.</li>
</ul>
</li>
<li><strong>Modifications to <code>terraphast/CMakeLists.txt</code>:</strong><ul>
<li>Changed the processing of <code>TERRAPHAST_ARCH_NATIVE</code> so that it now also adds
  an optimization level and produces options that as far as I know are correct
  on GCC, Clang and Intel (though the Intel option is not so good for AMD). 
  Note that a user doesn't have to set this flag to True as it is perfectly possible
  to pass suitable optimization options through <code>CMAKE_CXX_FLAGS</code> and
  <code>CMAKE_CXX_FLAGS_RELEASE</code>.
  <em>The change is not really needed to compile RAxML-NG as we can make sure the
  options are indeed passed through other CMAKE variables and that <code>TERRAPHAST_ARCH_NATIOVE</code>
  is turned off.</em></li>
<li>(Nonessential) Additional information given when GMP is found, and some other 
  changes to messages to make clearer where the message comes from.</li>
</ul>
</li>
<li><strong>Fixes to the terraphast code</strong><ul>
<li>Fixed an issue in <code>lib/bits.hpp</code> with an implicit type conversion from 
  sizt_t/uin64_t to uint8_t: 
  <code>inline uint8_t shift_index(index i) { return i % word_bits; }</code>
  should be replaced with
  <code>inline uint8_t shift_index(index i) { return (uint8_t) (i % word_bits); }</code></li>
<li>Even with the fix we already have, there are still issues with verbose_run      </li>
</ul>
</li>
</ul>
<h5 id="cmake-configuration-after-our-patches">CMake configuration after our patches</h5>
<table>
<tr><th>Variable</th>                <th>Default</th>            <th>Meaning</th></tr>
<tr><td>RAXML_BINARY_NAME</td>       <td></td>                   <td>Custom RAxML-NG binary name</td></tr>
<tr><td>USE_LIBPLL_CMAKE</td>        <td>ON</td>                 <td>Use CMake to build libpll and pll-modules. Will be forced to ON when building as a library</td></tr>
<tr><td>BUILD_AS_LIBRARY</td>        <td>OFF</td>                <td>Build RAxML-NG as shared library (instead of stand-alone executable). Naming is derived from the name of the matching executable.</td></tr>
<tr><td>USE_PTHREADS</td>            <td>ON</td>                 <td>Enable multi-threading support (PTHREADS)</td></tr>
<tr><td>USE_MPI</td>                 <td>OFF</td>                <td>Enable MPI support</td></tr>
<tr><td>USE_VCF</td>                 <td>OFF</td>                <td>??? No explanation available</td></tr>
<tr><td>ENABLE_PLLMOD_SIMD</td>      <td>OFF</td>                <td>Enable SIMD instructions in pll-modules (non-portable but slightly faster)</td></tr>
<tr><td>STATIC_BUILD</td>            <td>OFF</td>                <td>Build static binary (don't use with MPI!)</td></tr>
<tr><td>USE_TERRAPHAST</td>          <td>ON</td>                 <td>Use phylogentic terraces library (terraphast)</td></tr>
<tr><td>USE_GMP</td>                 <td>OFF</td>                <td>Use Gnu Muliple precision (GMP) library, only relevant for terraphast</td></tr>
<tr><td>CMAKE_C_FLAGS</td>           <td>""</td>                 <td></td></tr>
<tr><td>CMAKE_C_FLAGS_RELEASE</td>   <td>compiler-dependent</td> <td></td></tr>
<tr><td>CMAKE_C_FLAGS_DEBUG</td>     <td>-O0 -g</td>             <td></td></tr>
<tr><td>CMAKE_CXX_FLAGS</td>         <td>""</td>                 <td>Also used for MPI.</td></tr>
<tr><td>CMAKE_CXX_FLAGS_RELEASE</td> <td>compiler-dependent</td> <td></td></tr>
<tr><td>CMAKE_CXX_FLAGS_DEBUG</td>   <td>-O0 -g</td>             <td></td></tr>
<tr><td>MPI_CXX_COMPILER</td>        <td></td>                   <td>Used if USED_MPI is ON</td></tr>
<tr><td>MPI_CXX_COMPILER_FLAGS</td>  <td></td>                   <td>Used if USE_MPI is ON</td></tr>
<tr><td>ENABLE_SSE</td>              <td>True</td>               <td>Used to enable or explicitly disable SSE3 optimizations in libpll</td></tr>
<tr><td>ENABLE_AVX</td>              <td>True</td>               <td>Used to enable or explicitly disable AVX optimizations in libpll</td></tr>
<tr><td>ENABLE_AVX2</td>             <td>True</td>               <td>Used to enable or explicitly disable AVX2 optimizations in libpll</td></tr>
<tr><td>SSE_FLAGS</td>               <td>"-msse3"</td>           <td>Added to the compiler options by libpll for SSE3-specific files.</td></tr>
<tr><td>AVX_FLAGS</td>               <td>"-mavx"</td>            <td>Added to the compiler options by libpll for AVX-specific files.</td></tr>
<tr><td>AVX2_FLAGS</td>              <td>"-mfma -mavx2"</td>     <td>Added to the compiler options by libpll for AVX2-specific files.</td></tr>
<tr><td>ENFORCE_COMPILER_FLAGS</td>  <td>ON</td>                 <td>Enforce hard-coded compiler options for CMAKEX*_FLAGS_* in the RAxML-NG configuration files rather than the CMake defaults or user-specified ones.</td></tr>
</table>

<p><a href="../../..">[package list]</a></p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    <a href="https://github.com/hpcuantwerpen" target="_blank" rel="noopener" title="HPC-UAntwerpen on GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "header.autohide", "toc.follow", "content.code.annotate", "search.suggest"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.bd0b6b67.min.js"}</script>
    
    
      <script src="../../../assets/javascripts/bundle.467223ff.min.js"></script>
      
    
  </body>
</html>